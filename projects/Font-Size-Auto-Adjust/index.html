<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>フォントサイズ調整のテスト</title>
  <link rel="stylesheet" href="styles/main.css">
  <script>
    function calculate(){
      var sight = document.paramset.param_sight.value;
      var logmar = Math.LOG10E * Math.log(sight);
      var ppi = document.paramset.param_ppi.value;
      var ratio = document.paramset.param_pxratio.value;
      var distance = document.paramset.param_dist.value;
      
      var fontpoint = (ppi / ratio) / 72;
    
      //log10 [ 30 / 実際の測定距離 (cm) ]
      var logmar_calibration = logmar + (Math.LOG10E * Math.log(30 / distance));
      console.log("logmar_calibration: " +logmar_calibration);
      
      var logmar_pow = Math.pow(10,logmar_calibration);
      var calcfontsize = Math.tan(logmar_pow * 5/60 * Math.PI/180) * 1908;//TAN(10^A1*5/60*PI()/180)*1908
      
      var previewbox = document.getElementById("preview");
      
      var sightspan = document.getElementById("sightnum");
      var logmarspan = document.getElementById("logmarnum");
      var ppispan = document.getElementById("ppinum");
      var ratiospan = document.getElementById("rationum");
      var numspan = document.getElementById("pointnum");
      
      console.log("size is " + calcfontsize);
      sightspan.innerHTML = sight;
      logmarspan.innerHTML = logmar;
      
      ppispan.innerHTML = ppi;
      ratiospan.innerHTML = ratio;
      numspan.innerHTML = fontpoint;
      
      previewbox.style.fontSize = calcfontsize;
    }
  </script>
</head>
<body>
  <section id="paramaters">
    <form name="paramset" id="paramset" action="">
      <div class="paramaterbox">
        <span class="name">解像度</span>
        <div class="inputbox"><input type="text" value="227" id="param_ppi"></div>
        <span class="unit">ppi</span>
      </div>
      <div class="paramaterbox">
        <span class="name">ピクセル比</span>
        <div class="inputbox"><input type="text" value="2" id="param_pxratio"></div>
      </div>
      <div class="paramaterbox">
        <span class="name">あなたの視力</span>
        <div class="inputbox"><input type="text" value="1.0" id="param_sight" name="param_sight"> </div>

      </div>
      <div class="paramaterbox">
        <span class="name">ディスプレイとの距離</span>
        <div class="inputbox"><input type="text" value="50" id="param_dist"></div>
        <span class="unit">cm</span>
      </div>
      <input type="button" value="update" onclick="calculate();">
    </form>
  </section>
  <section id="preview">
   <!--例文：--><br>
    <strong>視力の換算</strong>：視力が<span id="sightnum">NaN</span>なので、logMAR値は<span id="logmarnum">NaN</span>となります。<br>
    <strong>ポイントの考え方はこれ？</strong>：解像度は<span id="ppinum">NaN</span>ppi (pixel per inch)であり、ピクセル比は<span id="rationum">NaN</span>なので、このディスプレイでの文字サイズ1ポイントの大きさは、72分の1インチ、つまり<span id="pointnum">NaN</span>ピクセルです。<br>
    臨界文字サイズの測定は、文字と目の距離が30cmであるのを基準としている。しかし距離を変えても計算可能：logMAR - 
    log10 [ 30 / 実際の測定距離 (cm) ] <br>
    文字サイズは「logMARから視角を計算し，そのtangentに定数をかけてポイントサイズに換算」することで求められます（http://www.cis.twcu.ac.jp/~k-oda/MNREAD-J/MNREADJ-QandA.html）。<br>
    
    <strong>M値</strong>：新聞を読むときに必要な倍率
    <!--よって、あなたの視力に基づいた最適な文字サイズはこの表示のとおりです。--><br>
    <br>
    
    <br>
    <div id="inchtest" style="width: 114px; border-top: 1px solid#000;">&nbsp;</div>
  </section>
</body>
</html>